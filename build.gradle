group 'com.sharpandrew'
version '1.0-SNAPSHOT'

buildscript {
    repositories {
        jcenter()
    }

    dependencies {
        classpath 'com.bmuschko:gradle-docker-plugin:3.0.3'
    }
}

apply plugin: 'application'
apply plugin: 'com.bmuschko.docker-java-application'
apply plugin: 'java'

mainClassName = 'com.sharpandrew.learndropwizard.HelloWorldApplication'
sourceCompatibility = 1.8

run {
    if(System.getProperty("exec.args") != null) {
        args System.getProperty("exec.args").split()
    }
}

sourceSets {
    main.java.srcDir "src/main/java"
    main.resources.srcDir "src/main/resources"
}

repositories {
    mavenCentral()
}

dependencies {
    compile group: 'io.dropwizard', name: 'dropwizard-core', version: "${dropwizardVersion}"
    testCompile group: 'junit', name: 'junit', version: '4.11'
}

// for `docker` block
configurations {
    dockerJava {
        resolutionStrategy {
            force 'de.gesellix:unix-socket-factory:2016-04-06T22-21-19'
        }
    }
}

def dockerTagName = "${group}/${name}:${version}"
def dockerPort = 8080

docker {
    javaApplication {
        baseImage = 'openjdk:8u102'
        maintainer = 'Andrew Sharp "me@sharpandrew.com"'
        ports = [dockerPort]
        tag = dockerTagName
    }
    url = 'unix:///var/run/docker.sock'
}

